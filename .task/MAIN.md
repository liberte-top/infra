# Task: 简化 infra 层代码

- **Branch:** feat/simplify-infra-layer
- **Status:** Active
- **Last-Sync:** 2026-02-25T04:41:48Z (on ZQXY123deMacBook-Pro.local)
- **Current Context:** 已将临时 SSH key 文件生成逻辑抽到 utils.sh，ansible/ssh 脚本统一复用。

## Phase Stack
> Current execution depth (Top is active)
  - 1.1: Baseline Snapshot & Simplification Scope

## Timeline
- [2026-02-25T03:37:46Z] INITIALIZED: Task started on ZQXY123deMacBook-Pro.local.
- [2026-02-25T03:37:46Z] PHASE PUSH: Begin Phase 1.1 (baseline snapshot + simplification scope alignment).
- [2026-02-25T03:48:43Z] UPDATE: Initialized .env from Host zhaoxi (host/user/key) and ran SSH smoke test successfully.
- [2026-02-25T03:55:48Z] UPDATE: Refactored scripts/ansible.sh to simplify flow and validated ansible/ansible-playbook dispatch paths.
- [2026-02-25T03:59:06Z] UPDATE: Removed dynamic TTY detection; keep fixed -it only for no-arg shell and regular execution path without -t.
- [2026-02-25T04:03:44Z] UPDATE: Switched no-arg behavior to ansible --version fallback and aligned AGENTS.md behavior docs.
- [2026-02-25T04:33:39Z] UPDATE: Removed command prediction in ansible.sh, switched to direct passthrough, and updated AGENTS.md examples to explicit ansible-playbook usage.
- [2026-02-25T04:38:58Z] UPDATE: Extracted default-args normalization into scripts/utils.sh (normalize_args) and wired ansible.sh to use it.
- [2026-02-25T04:40:02Z] UPDATE: Applied the same simplification to scripts/ssh.sh using normalize_args and require_command ssh.
- [2026-02-25T04:41:48Z] UPDATE: Extracted temporary SSH key file generation into shared utils function and reused it in ansible.sh/ssh.sh.

## Global References
- **Docs:** .task/MAIN.md
- **Scripts:** scripts/ansible.sh
- **Assets:** .task/resources/STRUCTURE_SNAPSHOT.txt
---
*Generated by .task Convention - Synchronized via Git*
